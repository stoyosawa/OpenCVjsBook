<!DOCTYPE html>
<html lang="ja-JP">
<head>
  <meta charset="UTF-8">
  <link id="linkTag" rel=stylesheet href="style.css"/>
  <script async id="scrTagOverlay" src="libs/overlay.js"></script>
  <script async id="scrTagOpencv" src="libs/opencv.js"></script>
  <script async id="scrTagNtc" src="https://chir.ag/projects/ntc/ntc.js"></script>
</head>
<body>

<h1>すべてのリソースを Promise 化する</h1>

<div>
  <img id="imageTag" src="samples/color-gradation.png"/>
</div>

<script> 
  let promises = [];
  let tags = ['linkTag', 'scrTagOverlay', 'scrTagOpencv', 'scrTagNtc'];

  tags.forEach(function(tag) {
    promises.push(new Promise(function(resolve, reject) {
      let elem = document.getElementById(tag);
      elem.addEventListener('load', function() {
        resolve(`loaded ${tag} at ${performance.now()}`);
      });
    }));
  });

  promises.push(new Promise(function(resolve,reject){
    window.addEventListener('load', function() {
      resolve(`loaded window at ${performance.now()}`);
    });
  }));

  promises.push(new Promise(function(resolve, reject) {
    Module = {
      onRuntimeInitialized: function() {
        resolve(`opencvInitialized at ${performance.now()}`);
      }
    }
  }));

  Promise.all(promises)
  .then(function(values) {
    console.log(values.join('\n'));
  });
</script>

</body>
</html>