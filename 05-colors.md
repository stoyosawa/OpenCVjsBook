## 第5章 色を扱う

### 4.6 カラーをモノクロ化する

// cv.cvtColorの導入。imgProc 章の 5.1 を使う。

### 4.7 画像をネガにする

// `cv.bitwise_not` を使う。RGBA は A を抜かないとだめ。


### 4.7 色相図を描く // `mat-draw-hue.html`

// カラーモデル HSV の説明。HSV->RGB 変換 (`cv.cvtColor()`)。絵の作成には`cv.matFromArray()`を使う。
// `Mat.data`を HSV として解釈する。

### 4.8 カラー画像を色要素に分解する

// cv.split。imgProc の 5.2 を使う。


1.3.5　カラーモデル
本節ではここまで、カラーを（赤, 緑, 青）の三原色で説明してきました。これをRGBカラーモデルといい、コンピュータや色彩工学で一般的に用いられる色の表現方法です。それぞれ、R（red）、G（green）、B（blue）を意味します。これ以外にも、いくつか異なるカラーモデルがあります。
OpenCVで利用可能な主要なカラーモデルを次の表に示します。

表1.2●カラーモデル
カラーモデル
色の要素
BGR
青－緑－赤（Blue－Gree－Red）
RGB
赤－緑－青（Red－Green－Blue）
GRAY
グレースケール
HSV
色相－彩度－明度（Hue－Saturation－Value）
YCrCb
輝度－赤み－青み（Y－Cr－Cb）

● BGRカラーモデル
OpenCVのデフォルトカラーモデルです。色の種類はRGBの3組とおなじですが、登場順序が違うため、おなじ値の組み合わせであっても最終的な色は異なります。
次に例を示します。中央に示したのがピクセルの値［32, 129, 230］です。これをRGBカラーモデルで解釈すると赤32、緑129、青230なので、結果の色はほぼ青です。これに対し、BGRは青32、緑129、赤230と解釈するのでオレンジ色です。

図1.16●3つのおなじ値の組み合わせをRGBとBGRで解釈したときの色

● HSVカラーモデル
色相（Hue）、彩度（Saturation）、明度（Value）の3つの値でカラーを構成するモデルをHSVといいます。色相は赤や青などの色合いを示し、色味ともいいます。彩度は色の鮮やかさを、明度は色の明るさをそれぞれ示します。
色相は色相環という円環で描かれるため、0度から360度までの値をとります。0度の赤からスタートし、黄、緑、水色（このあたりで180度）、青、紫と角度が進むにつれ色が変わり、最後の360度でもとの赤に戻ります。虹の色順とおなじです。
ただし、np.uint8が0～255の範囲しか表現できないため、半分にして0～179の値を用います。180～255の範囲は循環するので、180のモジュロ（剰余）で色相が得られます。たとえば、180は0と等しいので赤、200は200%180=20なので黄色です。np.int16が用いられると、0～360が使われます。こちらも、360以上の値は360のモジュロを取ります。
この半分角度の値と色の関係を次の表に示します。

表1.3●色相の値と色の対応
色相の値
0
30
60
90
120
150
179
色
赤
黄
緑
水色
青
紫
赤

彩度と明度の値は、一般的には0～100（あるいは0.0から1.0）のパーセント表記ですが、OpenCVでは0～255を用います。0が0%、255が100%を意味します。
例として、RGBでは青、BGRではオレンジだった［32, 129, 230］のピクセルを考えます。HSVで解釈すると、色相は黄土色（度数では64度）、鮮やかさは半分の50%、明度はかなり明るい90％になります。これとおなじ色はRGBでは［223, 230, 115］です。
HSVはHの値から直感的に色を把握できるため、イラストレータなどに好まれます。画像処理においても、4.3節のクロマキー合成のように背景の色に着目するときに用いられます。HSVは4.2節で扱います。
ウェブ（HTML/CSS）で用いられるカラーモデルはHSLで、このHSVとは微妙に異なるので気をつけてください。
● YCrCbカラーモデル
Y（輝度）、Cr（赤味）、Cb（青味）の3つの値でカラーを構成するモデルをYCrCbといいます。YCbCrというモデルもありますが、赤と青の順番が変わっただけです。正確にはCrは赤の強度から、Cbは青みの強度からそれぞれ輝度を引いた値ですが、自力で計算をしなければならないかぎり、気にする必要はありません。
画像処理では、JPEGなどの画像圧縮で用いられます。6.3節で取り上げます。
● カラーモデルの変換
各カラーモデルは、たとえばBGRからHSV、HSVからRGBのように相互に変換が可能です。変換式は公式リファレンスのColor conversionsページで説明されています。ある色を特定のカラーモデルで表現したときにどのような値を取るのか、あるいは同じ値がそれぞれのカラーモデルでどのような色になるのかは、インターネットのカラーチェックサイトで調べられるので、検索してください。
OpenCVにはcv2.cvtColorという画像全体のカラーモデルを相互変換する関数が備わっています。具体的には、BGRとGRAYは2.5節、BGRとHSVは4.2節と4.3節、BGRとYCrCbは6.3節でそれぞれ扱います。
● カラーの表示
NumPy配列では、どのカラーモデルであっても1ピクセルは［1, 2, 3］のように単なる数値の羅列です。カラーモデル名を示す属性はありません。そのため、BGRとして格納された画像をRGBとして読む、あるいはHSVのデータをBGRとして読むなど、誤った解釈も可能です。
OpenCVでは、画像はcv2.imshow関数（2.1節に関数定義）で表示します。関数は3つの数値の並びをBGRと解釈します。そのため、HSVなど他のカラーモデルをそのまま表示すると、プログラムでは不都合はないのに、色合いがおかしな画像が提示されるので注意が必要です。色変換は4.1節で扱います。

